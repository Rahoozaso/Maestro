import numpy as np

from astropy.io.fits.util import encode_ascii


def some_function_handling_output_field(format, output_field):
    """Example surrounding function context for handling FITS formatting.

    This is a simplified representation of the relevant logic from fitsrec.py.

    Parameters
    ----------
    format : str
        FITS format string for the column (e.g. 'E20.12', 'D20.12').
    output_field : numpy.ndarray or numpy.chararray
        Array containing the ASCII representation of the values for a given
        column, as generated by the FITS formatting machinery.

    Returns
    -------
    numpy.ndarray or numpy.chararray
        ``output_field`` with any ``E`` exponents converted to ``D`` when
        the format string uses a ``D`` exponent separator.
    """

    # ... other logic operating on output_field ...

    # Replace exponent separator in floating point numbers
    #
    # ``numpy.chararray.replace`` (and ``ndarray`` string methods in
    # general) are *not* in-place and instead return a new array.  The
    # original astropy code used ``output_field.replace(...)`` without
    # assigning the result, which meant the replacement had no effect.
    #
    # To ensure the exponent separator is actually updated, assign the
    # returned array back to ``output_field``.
    if "D" in format:
        output_field = output_field.replace(encode_ascii("E"), encode_ascii("D"))

    # ... rest of the function that returns or uses output_field ...
    return output_field